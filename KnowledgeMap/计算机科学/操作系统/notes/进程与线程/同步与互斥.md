# 同步与互斥
2022.07.10

[TOC]

## 同步与互斥的基本概念

在多道程序环境下，进程是并发执行的，不同进程之间存在着不同的相互制约关系。为了协调进程之间的相互制约关系，引入了进程同步的概念。下面举一个简单的例子来帮大家理解这个概念。例如，让系统计算 1+2×3，假设系统产生两个进程：一个是加法进程，一个是乘法进程。

要让计算结果是正确的，一定要让加法进程发生在乘法进程之后，但实际上操作系统具有异步性，若不加以制约，加法进程发生在乘法进程之前是绝对有可能的，因此要制定一定的机制去约束加法进程，让它在乘法进程完成之后才发生，而这种机制就是本节要讨论的内容。

### 临界资源

虽然多个进程可以共享系统中的各种资源，但其中许多资源一次只能为一个进程所用，我们将<u>一次仅允许一个进程使用的资源</u>称为**临界资源**。许多物理设备都属于临界资源，如打印机等。此外，还有许多变量、数据等都可以被若干进程共享，也属于临界资源。

<u>对临界资源的访问，必须互斥地进行</u>，在每个进程中，<u>访问临界资源的那段代码</u>称为**临界区**。

为了保证临界资源的正确使用，可把临界资源的访问过程分成4个部分：

* **进入区**。为了进入临界区使用临界资源，在进入区要<u>检查可否进入临界区</u>，若能进入临界区，则应<u>设置正在访问临界区的标志</u>，以阻止其他进程同时进入临界区。
* **临界区**。<u>进程中访问临界资源的那段代码，又称临界段</u>。
* **退出区**。将正在访问临界区的<u>标志清除</u>。
* **剩余区**。代码中的其余部分。

```c
do{
	entry section; // 进入区	
  critical section; // 临界区
  exit section; // 退出区
  reminderr section; // 剩余区
}
```

### 同步

**同步**亦称**直接制约关系**，是指为完成某种任务而建立的两个或多个进程，这些进程因为需要在某些位置上<u>协调它们的工作次序而等待、传递信息所产生的制约关系</u>。进程间的直接制约关系源于它们之间的相互合作。

例如，输入进程 A 通过单缓冲向进程B提供数据。当该缓冲区空时，进程B不能获得所需数据而阻塞，一旦进程 A 将数据送入缓冲区，进程B就被唤醒。反之，当缓冲区满时，进程 A被阻塞，仅当进程B取走缓冲数据时，才唤醒进程 A。

### 互斥

**互斥**也称**间接制约关系**。当一个进程进入临界区<u>使用临界资源</u>时，另一个进程必须等待，当占用临界资源的进程退出临界区后，另一进程才允许去访问此临界资源。

例如，在仅有一台打印机的系统中，有两个进程 A 和进程 B，若进程 A 需要打印时，系统己将打印机分配给进程 B，则进程 A 必须阻塞。一旦进程 B 将打印机释放，系统便将进程 A唤醒，并将其由阻塞态变为就绪态。

为禁止两个进程同时进入临界区，同步机制应遵循以下准则：

* **空闲让进**。临界区空闲时，可以允许一个请求进入临界区的进程立即进入临界区。
* **忙则等待**。当己有进程进入临界区时，其他试图进入临界区的进程必须等待。
* **有限等待**。对请求访问的进程，应保证能在有限时间内进入临界区。
* **让权等待**。当进程不能进入临界区时，应立即释放处理器，防止进程忙等待

## 实现临界区互斥的基本方法

### 软件实现方法



### 硬件实现方法



## 互斥锁



## 信号量



## 管程



## 经典同步问题


# 计算机系统层次结构
2022.03.18

[TOC]

## 计算机系统的组成

1. 计算机系统=软件(硬件上运行的程序和相关数据与文档)+硬件(有型的物理设备)
2. 软硬件实现功能逻辑上等效，用硬件解决问题效率高，成本低

## 计算机硬件

- [ ] 冯诺伊曼机基本思想

  1. “存储程序”工作方式
  2. 运算器、存储器、控制器、输入设备、输出设备
  3. 指令和数据同等地位存储在存储器中
  4. 指令和数据用二进制代码表示

- [ ] 计算机功能部件

  1. 输入设备

  2. 输出设备

  3. 存储器

     1. 存储器种类：主存(CPU直接访问)，辅存

     2. 主存组成

        1. 存储体M

           **存储体**包含**存储单元**，存储单元包含**存储元件**，每个存储元件存储一个0或1，存储单元存储一串二进制代码，叫做**存储字**，存储字的长度叫**存储字长**。存储字长可以是n字节。

        2. 地址寄存器MAR

           MAR二进制位数反映了存储单元数量

        3. 数据寄存器MDR

           MDR二进制位数反映了**存储字长**

        4. 时序逻辑

     3. 存取方式:按地址存取

  4. 运算器

     1. 算术运算、逻辑运算
     2. 组成：算术逻辑单元ALU，各种寄存器。**ACC、MQ乘商寄存器、操作数寄存器X是必须的**

  5. 控制器

     1. 程序计数器PC
     2. 指令寄存器IR
     3. 控制单元CU

  图为冯·诺依曼结构的模型机。CPU包含**ALU**、通用寄存器组**GPRs**、**标志寄存器**、**控制器**、**指令寄存器IR**、程序计数器**PC**、存储器地址寄存器**MAR**和存储器数据寄存器**MDR**。图中从控制器送出的虚线就是控制信号，可以控制如何修改PC以得到下一条指令的地址，可以控制ALU执行什么运算，可以控制主存是进行读操作还是写操作（读/写控制信号）。

  <img src="resources/冯诺伊曼模型机.png" alt="冯诺伊曼模型机" style="zoom:80%;" />

## 计算机软件

1. 系统软件：操作系统OS、数据库管理系统DBMS、语言处理程序、分布式软件系统、网络软件系统、标准库程序、服务性程序等。
2. 应用软件：为解决某个应用领域中的各类问题而编制的程序，如各种科学计算类程序、工业设计类程序、数据统计与处理程序等。

3. 机器语言，汇编语言，高级语言

4. 汇编程序(汇编->机器语言)；解释程序；编译程序

5. 下列()不属于系统软件。

   A.数据库系统

   B.操作系统

   C.编译程序

   D.以上3种都属于系统程序

   【答案】：A，数据库系统是指在计算机系统中引入数据库后的系统，一般由数据库、数据库管理系统、应用系统、数据库管理员构成，其中数据库管理系统是系统程序。

6. 【2016统考真题】将高级语言源程序转换为机器级目标代码文件的程序是（)。

   A.汇编程序

   B.链接程序

   C.编译程序

   D.解释程序

   翻译程序是指把高级语言源程序转换成机器语言程序（目标代码）的软件。翻译程序有两种：一种是编译程序，它将高级语言源程序一次全部翻译成目标程序。另一种是解释程序，它将源程序的一条语句翻译成对应的机器目标代码，并立即执行，翻译一句执行一句，并且不会生成目标程序。汇编程序也是一种翻译程序，它把汇编语言源程序翻译为机器语言程序。->C

## 计算机系统的层次结构

<img src="resources/分层结构.png" alt="分层结构" style="zoom:67%;" />

## 计算机系统的工作原理

1. 存储程序工作方式

   1. 程序执行前，指令与数据送入主存
   2. 程序执行过程：取指、译码、计算下条指令地址、取数并执行、结果送回存储器

2. 从源程序到可执行程序

   <img src="resources/程序.png" alt="程序" style="zoom:80%;" />

   * 预处理阶段：比如#include命令后边的.h内容插入程序文件
   * 编译阶段：生成汇编程序
   * 汇编阶段：汇编程序转换为机器指令
   * 链接阶段：各种.o程序合并，比如hello.o+printf.o->hello

3. 指令执行过程的描述

   1. 取指令：(PC)->MAR->M->MDR->IR;(PC)+1->PC
   2. 分析指令：OP(IR)->CU
   3. 执行指令(比如取数操作)：CU->MAR->M->MDR->ACC

4. 例题：

   1. CPU不包括()。

      A.地址寄存器

      B.指令寄存器(IR)

      C.地址译码器

      D.通用寄存器

      【答案】：C

   2. 关于相联存储器，下列说法中正确的是（C)。

      A.只可以按地址寻址

      B.只可以按内容寻址

      C.既可按地址寻址又可按内容寻址

      D.以上说法均不完善

   3. 某台计算机只有Load/Store指令能对存储器进行读/写操作，其他指令只对寄存器进行操作。根据程序跟踪试验结果，已知每条指令所占的比例及CPI数如下表所示。

      | 指令类型     | 指令占比 | CPI  |
      | ------------ | -------- | ---- |
      | 算术逻辑指令 | 43%      | 1    |
      | Load指令     | 21%      | 2    |
      | Store指令    | 12%      | 2    |
      | 转移指令     | 24%      | 2    |

      求上述情况的平均CPI
      $$
      0.43+0.42+0.24+0.48=1.57
      $$
      假设程序由M条指令组成。算术逻辑运算中25%的指令的两个操作数中的一个已在存器中，另一个必须在算术逻辑指令执行前用Load指令从存储器中取到寄存器中。此有人建议增加另一种算术逻辑指令，其特点是一个操作数取自寄存器，另一个操数取自存储器，即寄存器-存储器类型，假设这种指令的CPI等于2。同时，转移指的CPI变为3。求新指令系统的平均CPI。

      | 指令类型       | 原数量 | 原CPI | 新数量                | 新占比 | 新CPI |
      | -------------- | ------ | ----- | --------------------- | ------ | ----- |
      | 算数逻辑指令   | 0.43M  | 1     | 0.43M*0.75=0.3225M    |        | 1     |
      | Load           | 0.21M  | 2     | 0.21M-0.43M/4=0/1024M |        | 3     |
      | Store          | 0.12M  | 2     | 0.12M                 |        | 2     |
      | 转移指令       | 0.24M  | 2     | 0.24M                 |        | 3     |
      | 新算数逻辑指令 |        |       | 0.43*0.25M=0.1075M    |        | 2     |

      $$
      \frac{1.57M-0.43M*0.25(一部分算术逻辑指令减少)-0.43M*0.25(一部分算术逻辑指令的减少使Load减少)+0.24M*1(转移指令)}{M-0.43M*0.25}=
      $$

      
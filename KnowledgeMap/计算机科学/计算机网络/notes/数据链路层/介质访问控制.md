# 介质访问控制

## 信道划分介质访问控制

属于**静态划分信道**的方法

1. 频分复用FDM

2. 时分复用TDM / 同步时分复用

3. 统计时分复用STDM / 异步时分复用

   * **STDM帧的时隙数小于集中器连接的用户数**

4. 波分复用WDM

   1. 光复用器=合波器；掺铒光纤放大器EDFA(Erbium Doped Fiber Amplifier)；光分用器=分波器
   2. 密集波分复用DWDM

5. 码分复用CDM

   1. [通俗理解CDMA](https://blog.csdn.net/dog250/article/details/6420427)

   2. 沃尔什向量

      ![沃尔什向量](../../../../计算机科学/计算机网络/notes/物理层/resources/沃尔什向量.png)

   3. 一个比特被分为m bit的码片(Chip)，m通常为64或128

   4. 每一个站被指派自己的码片序列(取m=8)，比如：

      |      |   编码   |            码片序列            |
      | ---- | :------: | :----------------------------: |
      | A的1 | 11110000 |   1，1，1，1，-1，-1，-1，-1   |
      | A的0 | 00001111 |   -1，-1，-1，-1，1，1，1，1   |
      | B的1 | 11111111 |     1，1，1，1，1，1，1，1     |
      | B的0 | 00000000 | -1，-1，-1，-1，-1，-1，-1，-1 |

      CSMA要求，不同编码必须正交

      发送端，A发送0，B发送1
      $$
      [-1,-1,-1,-1,+1,+1,+1,+1]\\+[+1,+1,+1,+1,+1,+1,+1,+1]\\=
      [0,0,0,0,2,2,2,2]
      $$
      A接受端
      $$
      \frac{[0,0,0,0,2,2,2,2]\cdot [1,1,1,1,-1,-1,-1,-1]}{8}=-1
      $$
      B接受端
      $$
      \frac{[0,0,0,0,2,2,2,2]\cdot [1,1,1,1,1,1,1,1]}{8}=1
      $$

   5. 扩频(Spread Specturm)

      1. 原因：一个码片有m位，原来发送比特速率为b bit/s，现在就需要扩充到mb bit/s，对应的频率域也需要扩充。
      2. 直接序列扩频（DSSS）
      3. 调频扩频（FHSS）

## 随机访问介质访问控制

属于**动态划分信道**的方法

1. ALOHA协议：不听就说

   1. **纯ALOHA协议**

      1. 发送：想发就发
      2. 冲突：等会儿再发
      3. 网络吞吐量：S是T时间内成功发送帧数，G是网络负载量

      $$
      S = G\cdot e^{-2G}\\
      S_{max}=S(0.5)=0.184
      $$

   2. **时隙ALOHA协议**

      1. 发送：时隙开始时发
      2. 冲突：下个时隙概率p重传，否则以此类推
      3. 网络吞吐量：S是T时间内成功发送帧数，G是网络负载量

      $$
      S = G\cdot e^{-G}\\
      S_{max}=S(0.5)=0.368
      $$

2. CSMA协议：先听再说——“听”：监测电压摆动值

   1. **1-坚持CSMA**
      1. 信道空闲：**立刻传输**
      2. 信道忙：忙则等待，**一直监听信道，空闲立刻传输**
      3. 发生冲突(一段时间内未收到肯定回复)：等待一个随机长的时间再监听,重复上述过程。
      4. 优点:只要媒体空闲,站点就马上发送,避免了媒体利用率的损失。
      5. 缺点:假如有两个或两个以上的站点有数据要发送,冲突就不可避免。
   2. **非坚持CSMA**
      1. 信道空闲：**立刻传输**
      2. 信道忙：忙则等待，**等待随机时间后，再监测到空闲再传输**
      3. 优点:采用随机的重发延迟时间可以减少冲突发生的可能性。
      4. 缺点:可能存在大家都在延迟等待过程中,使得媒体仍可能处于空闲状态,媒体使用率降低。

   1. **p-坚持CSMA**
      1. 信道空闲：**概率p传输本时间槽传输，概率1-p下一个时间槽传输**
         1. 信道忙：忙则等待，**等待随机时间后，再监测到空闲再传输**
         2. 优点：既能像非坚持算法那样减少冲突,又能像1-坚持算法那样减少媒体空闲时间的这种方案。
         3. 缺点：发生冲突后还是要坚持把数据帧发送完,造成了浪费。

   |  种类  |                   信道空闲                   |               信道忙               |
   | :----: | :------------------------------------------: | :--------------------------------: |
   | 1-坚持 |                    直接发                    |          一直监听直到空闲          |
   | 非坚持 |                    直接发                    | （改进方案）过会儿监听看看是否空闲 |
   | p-坚持 | （改进方案）概率p现在发，概率1-p下一时间槽发 |       过会儿监听看看是否空闲       |

   

3. **CSMA/CD**

   * 适用网络：**总线型或半双工**

   * 先听再说，边说边听，冲突不说，随机重说

   * 步骤

     1)适配器从网络层获得一个分组,封装成以太网帧,放入适配器的缓存,准备发送。

     2)如果适配器侦听到信道**空闲**,那么它开始**发送**该帧。如果适配器侦听到信道**忙**,那么它**持续侦听**直至信道上没有信号能量,然后开始发送该帧。

     3)在发送过程中,适配器**持续检测**信道。若一直未检测到碰撞,则顺利地把这个帧发送完毕。若检测到**碰撞**,则**中止数据的发送**,并发送一个**拥塞信号**,以让所有用户都知道

     4)在中止发送后,适配器就执行**指数退避算法**,等待一段随机时间后返回到步骤2)。

   * **争用期/冲突窗口/碰撞窗口**：2τ (端到端传播时延的二倍)

   * **最小帧长**：

     * 原因（个人理解）：争用期可能发送的最多内容是最小帧长。如果争用期时检测到碰撞，发送就会停止，接收端收到内容小于最小帧长说明没发完，直接丢弃；如果争用期时未检测到碰撞，会成功发送，帧长会大于最小帧长。

     $$
     最小帧长=总线传播时延\cdot 数据传输速率\cdot 2
     $$

     * 应用：以太网帧最小帧长为64B，内容少于64B的帧会用整数个字节填充。

   * 二进制指数规避算法/动态退避：

     1)确定**基本退避时间**,一般取两倍的总线端到端传播时延**2τ**(即**争用期**)。

     2)定义参数重传次数k,它等于重传次数,但k不超过1,即**k=min[重传次数,10]**。当重传次数不超过10时,k等于重传次数;当重传次数大于10时,k就不再增大而一直等于10(这个条件往往容易忽略,请读者注意)。

     3)从离散的**整数集合[0,1,..,2-1]中随机取出一个数r**,重传所需要退避的时间就是r倍的基本退避时间,即**2rτ**

     4)当重传达**16次仍不能成功**时,说明网络太拥挤,认为此帧永远无法正确发出,**抛弃此帧**并向高层报告出错(这个条件也容易忽略,请读者注意)。

4. **CSMA/CA**

   * 适用网络：**无线**连接局域网（有线连接局域网——CSMA/CD）

   * 不用CSMA/CD原因：1. **碰撞检测硬件花费大**（接收信号强度低，信号强度变化范围大）2. **“隐蔽站”问题**：当A和C都检测不到信号,认为信道空闲时,同时向终端B发送数据帧,就会导致冲突。

   * 802.11规定帧间间隔**IFS**

     1)[**SIFS**](https://en.wikipedia.org/wiki/Short_Interframe_Space)(短IFS):最短的IFS,用来分隔属于一次对话的各帧,使用SIFS的帧类型有ACK帧、CTS帧、分片后的数据帧,以及所有回答AP探询的帧等。

     2)[**PIFS**](https://en.wikipedia.org/wiki/Point_coordination_function#PCF_Interframe_Space)(点协调IFS):中等长度的IFS,在PCF操作中使用。

     3)**[DIFS](https://en.wikipedia.org/wiki/Distributed_coordination_function)**(分布式协调IFS):最长的IFS,用于异步帧竞争访问的时延。

   * **CSMA/CA算法**（RTS与CTS可选）

     * **RTS**（request to send - 请求发送），发送数据前,先检测信道是否空闲。RTS包括发射端的地址、接收端的地址、下一份数据将持续发送的时间等信息;信道忙则等待。
     * 接收端收到RTS后,将响应**CTS**( clear to send)。
     * 发送端收到CTS后,开始发送数据帧(同时**预约信道**:发送方告知其他站点自己要传多久数据)
     * 接收端收到数据帧后,将用CRC来检验数据是否正确,正确则响应**ACK帧**。
     * 发送方收到ACK就可以进行下一个数据帧发送,若没有则一直重传至规定重发次数为止(采用**二进制指数退避算法**来确定随机的推迟时间)

   * **处理隐蔽站问题**

     * RTS与CTS

## 轮询访问介质访问控制

**令牌传递协议**（属于**动态划分信道**的）

* 令牌（Token）

* 传数据步骤：

  1)网络**空闲**时,环路中只有令牌帧在**循环传递**。

  2)令牌传递到**有数据要发送**的站点时,该站点就**修改令牌中的一个标志位**,并在令牌中**附加**自己需要传输的**数据**,将令牌变成一个数据帧,然后将这个数据帧发送出去

  3)**数据帧(令牌)沿着环路传输**,接收到的**站点**一边转发数据,一边**查看帧的目的地址**。如果目的地址和自己的地址**相同**,那么接收站就**复制数据帧**以便进一步处理。

  4)数据帧沿着环路传输,直到到达该帧的**源站点**,源站点收到自己发出去的帧后便**不再转发**。同时,通过检验返回的帧来查看数据传输过程中**是否出错**,若有错则重传。

  5)**源站点**传送完数据后,**重新产生一个令牌**,并传递给下一站点,以交出信道控制权。

* 适用类型：负载很高的广播信道

* 物理拓扑：不一定是环
  逻辑拓扑：环